<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha Cadastral de Paciente</title>
    <!-- Tailwind CSS para estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Favicon para um toque profissional -->
    <link rel="icon" href="https://placehold.co/32x32/3b82f6/ffffff?text=P" type="image/png">
    <style>
        /* Estilo para um scroll mais suave */
        html {
            scroll-behavior: smooth;
        }
        /* Estilo para os placeholders dos campos de texto */
        ::placeholder {
            color: #9ca3af;
        }
        /* Estilo para ocultar os botões de rádio originais */
        .custom-radio {
            display: none;
        }
        /* Estilizando a label para parecer um botão */
        .custom-radio + label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
            font-weight: 500;
        }
        /* Estilo quando o rádio está selecionado */
        .custom-radio:checked + label {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
         /* Estilo para customizar checkboxes */
        .custom-checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            background-color: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease-in-out;
        }
        .custom-checkbox-label:hover {
            border-color: #9ca3af;
        }
        input[type="checkbox"]:checked + .custom-checkbox-label {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #1e40af;
        }
        input[type="checkbox"] {
            display: none;
        }
        .checkbox-text {
             margin-left: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <!-- Cabeçalho da página -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Ficha Cadastral de Paciente</h1>
            <p class="text-gray-600 mt-2">Preencha os campos abaixo com as informações do paciente.</p>
        </header>

        <!-- Formulário principal -->
        <form id="patient-form" class="bg-white p-6 md:p-8 rounded-lg shadow-lg space-y-8">

            <!-- Seção 1: Identificação do Paciente -->
            <fieldset class="border-t-4 border-blue-500 rounded-t-md pt-4">
                <legend class="text-xl font-semibold text-gray-700 px-2">1. Identificação do Paciente</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <!-- Nome Completo -->
                    <div class="md:col-span-2">
                        <label for="nome" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                        <input type="text" id="nome" name="nome" placeholder="Digite o nome completo" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Filiação -->
                    <div class="md:col-span-2">
                        <label for="filiacao" class="block text-sm font-medium text-gray-700">Filiação (Nome da Mãe/Pai)</label>
                        <input type="text" id="filiacao" name="filiacao" placeholder="Digite o nome da mãe e/ou do pai" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- CPF -->
                    <div>
                        <label for="cpf" class="block text-sm font-medium text-gray-700">CPF</label>
                        <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <!-- Telefone -->
                     <div>
                        <label for="telefone" class="block text-sm font-medium text-gray-700">Telefone</label>
                        <input type="tel" id="telefone" name="telefone" placeholder="(00) 90000-0000" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Endereço -->
                    <div class="md:col-span-2">
                        <label for="endereco" class="block text-sm font-medium text-gray-700">Endereço Completo</label>
                        <input type="text" id="endereco" name="endereco" placeholder="Rua, Número, Bairro, Cidade - Estado, CEP" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Idade -->
                    <div>
                        <label for="idade" class="block text-sm font-medium text-gray-700">Idade</label>
                        <input type="number" id="idade" name="idade" placeholder="Apenas números" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Sexo -->
                    <div>
                        <label for="sexo" class="block text-sm font-medium text-gray-700">Sexo</label>
                        <select id="sexo" name="sexo" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Selecione</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Feminino">Feminino</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <!-- Peso -->
                    <div>
                        <label for="peso" class="block text-sm font-medium text-gray-700">Peso (kg)</label>
                        <input type="number" step="0.1" id="peso" name="peso" placeholder="Ex: 70.5" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Altura -->
                    <div>
                        <label for="altura" class="block text-sm font-medium text-gray-700">Altura (m)</label>
                        <input type="number" step="0.01" id="altura" name="altura" placeholder="Ex: 1.75" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- IMC -->
                    <div class="md:col-span-2">
                        <label for="imc" class="block text-sm font-medium text-gray-700">IMC (Índice de Massa Corporal)</label>
                        <input type="text" id="imc" name="imc" placeholder="Calculado automaticamente" readonly class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md shadow-sm focus:outline-none cursor-not-allowed">
                    </div>
                    <!-- Ocupação -->
                    <div class="md:col-span-2">
                        <label for="ocupacao" class="block text-sm font-medium text-gray-700">Ocupação/Profissão</label>
                        <input type="text" id="ocupacao" name="ocupacao" placeholder="Qual a profissão atual?" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Etnia -->
                    <div>
                        <label for="etnia" class="block text-sm font-medium text-gray-700">Etnia/Cor</label>
                        <select id="etnia" name="etnia" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Selecione uma opção</option>
                            <option value="Branca">Branca</option>
                            <option value="Preta">Preta</option>
                            <option value="Parda">Parda</option>
                            <option value="Amarela">Amarela</option>
                            <option value="Indígena">Indígena</option>
                            <option value="Não declarada">Não desejo declarar</option>
                        </select>
                    </div>
                    <!-- Tipagem Sanguínea -->
                    <div>
                        <label for="tipagem_sanguinea" class="block text-sm font-medium text-gray-700">Tipagem Sanguínea</label>
                        <select id="tipagem_sanguinea" name="tipagem_sanguinea" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Selecione</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                            <option value="Não sei">Não sei</option>
                        </select>
                    </div>
                     <!-- Naturalidade -->
                     <div>
                        <label for="naturalidade" class="block text-sm font-medium text-gray-700">Naturalidade (Estado)</label>
                        <input type="text" id="naturalidade" name="naturalidade" placeholder="Ex: São Paulo" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Cidade Natal -->
                    <div>
                        <label for="cidade_natal" class="block text-sm font-medium text-gray-700">Cidade Natal</label>
                        <input type="text" id="cidade_natal" name="cidade_natal" placeholder="Ex: Campinas" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Escolaridade -->
                    <div>
                        <label for="escolaridade" class="block text-sm font-medium text-gray-700">Escolaridade</label>
                         <select id="escolaridade" name="escolaridade" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Selecione o grau</option>
                            <option value="Analfabeto">Analfabeto</option>
                            <option value="Ensino Fundamental Incompleto">Ensino Fundamental Incompleto</option>
                            <option value="Ensino Fundamental Completo">Ensino Fundamental Completo</option>
                            <option value="Ensino Médio Incompleto">Ensino Médio Incompleto</option>
                            <option value="Ensino Médio Completo">Ensino Médio Completo</option>
                            <option value="Ensino Superior Incompleto">Ensino Superior Incompleto</option>
                            <option value="Ensino Superior Completo">Ensino Superior Completo</option>
                            <option value="Pós-graduação">Pós-graduação</option>
                        </select>
                    </div>
                    <!-- Religião -->
                    <div>
                        <label for="religiao" class="block text-sm font-medium text-gray-700">Religião</label>
                        <input type="text" id="religiao" name="religiao" placeholder="Opcional" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </fieldset>

            <!-- Seção 2: Histórico Social -->
            <fieldset class="border-t-2 border-gray-200 pt-4">
                <legend class="text-xl font-semibold text-gray-700 px-2">2. Histórico Social</legend>
                <div class="space-y-6 mt-4">
                    <!-- Gerador de itens de histórico social -->
                    <script>
                        const socialHistoryItems = [
                            { id: 'tabagismo', label: 'Tabagismo?', placeholder: 'Frequência / Quantidade', default: 'Não' },
                            { id: 'etilismo', label: 'Etilismo?', placeholder: 'Frequência / Quantidade', default: 'Não' },
                            { id: 'drogas_ilicitas', label: 'Uso de drogas ilícitas?', placeholder: 'Qual droga e frequência', default: 'Não' },
                            { id: 'sedentarismo', label: 'Sedentarismo?', placeholder: 'Se não, qual atividade e frequência?', default: 'Sim' },
                            { id: 'ingestao_sal', label: 'Ingestão elevada de sal?', placeholder: 'Descreva os hábitos alimentares', default: 'Não' },
                            { id: 'transtorno_social', label: 'Possui transtorno social?', placeholder: 'Se sim, qual?', default: 'Não' }
                        ];

                        socialHistoryItems.forEach(item => {
                            document.write(`
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                    <span class="font-medium text-gray-700">${item.label}</span>
                                    <div class="flex space-x-4">
                                        <input type="radio" id="${item.id}_sim" name="${item.id}" value="Sim" class="custom-radio" ${item.default === 'Sim' ? 'checked' : ''}>
                                        <label for="${item.id}_sim">Sim</label>
                                        <input type="radio" id="${item.id}_nao" name="${item.id}" value="Não" class="custom-radio" ${item.default === 'Não' ? 'checked' : ''}>
                                        <label for="${item.id}_nao">Não</label>
                                    </div>
                                    <input type="text" name="${item.id}_detalhes" placeholder="${item.placeholder}" class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            `);
                        });
                    </script>
                </div>
            </fieldset>

            <!-- Seção 3: Histórico Familiar -->
            <fieldset class="border-t-2 border-gray-200 pt-4">
                <legend class="text-xl font-semibold text-gray-700 px-2">3. Histórico Familiar</legend>
                <p class="text-sm text-gray-500 mt-2 mb-4">Para cada condição, especifique o parentesco (ex: Pai, Avó materna, Tio paterno).</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 mt-4">
                    <div class="flex items-center gap-4">
                        <label for="familiar_cardiopatia" class="w-1/3 font-medium text-gray-700">Cardiopatia</label>
                        <input type="text" id="familiar_cardiopatia" name="familiar_cardiopatia" placeholder="Parentesco" class="flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div class="flex items-center gap-4">
                        <label for="familiar_neoplasia" class="w-1/3 font-medium text-gray-700">Neoplasia</label>
                        <input type="text" id="familiar_neoplasia" name="familiar_neoplasia" placeholder="Parentesco" class="flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex items-center gap-4">
                        <label for="familiar_diabetes" class="w-1/3 font-medium text-gray-700">Diabetes</label>
                        <input type="text" id="familiar_diabetes" name="familiar_diabetes" placeholder="Parentesco" class="flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex items-center gap-4">
                        <label for="familiar_drc" class="w-1/3 font-medium text-gray-700">DRC</label>
                        <input type="text" id="familiar_drc" name="familiar_drc" placeholder="Parentesco" class="flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex items-center gap-4">
                        <label for="familiar_respiratorio" class="w-1/3 font-medium text-gray-700">Doença Respiratória</label>
                        <input type="text" id="familiar_respiratorio" name="familiar_respiratorio" placeholder="Parentesco" class="flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </fieldset>

            <!-- Seção 4: Histórico de Medicamentos -->
            <fieldset class="border-t-2 border-gray-200 pt-4">
                <legend class="text-xl font-semibold text-gray-700 px-2">4. Histórico de Medicamentos</legend>
                <div class="grid grid-cols-1 gap-6 mt-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Classes de medicamentos que o paciente já usou (marque todas que se aplicam)</label>
                        <div id="medicamentos-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                            <!-- Checkboxes de classes de medicamentos são gerados aqui -->
                        </div>
                    </div>
                    <div>
                        <label for="medicamentos_outros" class="block text-sm font-medium text-gray-700">Outros medicamentos ou detalhes</label>
                        <textarea id="medicamentos_outros" name="medicamentos_outros" rows="2" class="block w-full mt-1 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Especifique outros medicamentos ou detalhes das classes selecionadas."></textarea>
                    </div>
                    <div>
                        <label for="hipersensibilidade" class="block text-sm font-medium text-gray-700">Hipersensibilidade / Alergias</label>
                        <textarea id="hipersensibilidade" name="hipersensibilidade" rows="3" class="block w-full mt-1 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Descreva qualquer alergia ou reação adversa a medicamentos conhecida."></textarea>
                    </div>
                </div>
            </fieldset>
            
            <!-- Seção 5: Queixa Atual -->
            <fieldset class="border-t-2 border-gray-200 pt-4">
                <legend class="text-xl font-semibold text-gray-700 px-2">5. Queixa Atual</legend>
                <div class="grid grid-cols-1 gap-6 mt-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sintomas e queixas principais (marque todos que se aplicam)</label>
                        <div id="queixas-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                             <!-- Checkboxes de queixas são gerados aqui -->
                        </div>
                    </div>
                     <div>
                        <label for="queixa_detalhes" class="block text-sm font-medium text-gray-700">Detalhes da Queixa Atual / Outras</label>
                        <textarea id="queixa_detalhes" name="queixa_detalhes" rows="3" class="block w-full mt-1 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Descreva com mais detalhes os sintomas, quando começaram, intensidade, etc."></textarea>
                    </div>
                </div>
            </fieldset>
            
            <!-- Ações do formulário -->
            <div class="flex flex-col md:flex-row items-center justify-end gap-4 pt-4 border-t-2 border-gray-200">
                 <button type="button" id="clear-form" class="w-full md:w-auto px-6 py-2.5 bg-gray-500 text-white font-medium text-sm leading-tight uppercase rounded-md shadow-md hover:bg-gray-600 hover:shadow-lg focus:bg-gray-600 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-gray-700 active:shadow-lg transition duration-150 ease-in-out">
                    Limpar Ficha
                </button>
                <button type="button" id="export-excel" class="w-full md:w-auto px-6 py-2.5 bg-green-600 text-white font-medium text-sm leading-tight uppercase rounded-md shadow-md hover:bg-green-700 hover:shadow-lg focus:bg-green-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-green-800 active:shadow-lg transition duration-150 ease-in-out">
                    Exportar para Excel
                </button>
            </div>
        </form>
         <!-- Rodapé -->
        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>&copy; 2024 Ficha Cadastral. Todos os direitos reservados.</p>
        </footer>
    </div>
    
    <!-- Modal de confirmação -->
    <div id="confirmation-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                    <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Sucesso!</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500" id="modal-message"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-modal" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Populando Checkboxes Dinamicamente ---
            const
            medicamentosContainer = document.getElementById('medicamentos-container');
            const queixasContainer = document.getElementById('queixas-container');

            const classesMedicamentos = [
                'Analgésicos', 'Anti-inflamatórios', 'Antibióticos', 'Antifúngicos', 'Antivirais', 'Anti-hipertensivos',
                'Diuréticos', 'Antidiabéticos', 'Hipolipemiantes', 'Anticoagulantes', 'Broncodilatadores', 'Corticosteroides',
                'Antiácidos', 'Antialérgicos', 'Antidepressivos', 'Ansiolíticos', 'Antipsicóticos', 'Anticonvulsivantes', 'Hormônios'
            ];

            const queixasComuns = [
                'Febre', 'Dor de cabeça', 'Tosse', 'Falta de ar', 'Dor no peito', 'Dor abdominal', 'Náusea/Vômito', 'Diarreia',
                'Tontura', 'Fadiga', 'Dor nas costas', 'Dor de garganta', 'Coriza', 'Perda de peso', 'Insônia', 'Ansiedade'
            ];

            const createCheckbox = (item, groupName) => {
                const id = `${groupName}_${item.replace(/ /g, '_').toLowerCase()}`;
                return `
                    <div>
                        <input type="checkbox" id="${id}" name="${groupName}" value="${item}">
                        <label for="${id}" class="custom-checkbox-label">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 12.6111L8.92308 17.5L20 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <span class="checkbox-text text-sm">${item}</span>
                        </label>
                    </div>
                `;
            };

            classesMedicamentos.forEach(item => medicamentosContainer.innerHTML += createCheckbox(item, 'medicamento_classe'));
            queixasComuns.forEach(item => queixasContainer.innerHTML += createCheckbox(item, 'queixa_item'));

            // --- Lógica do Formulário ---
            const pesoInput = document.getElementById('peso');
            const alturaInput = document.getElementById('altura');
            const imcInput = document.getElementById('imc');
            const exportButton = document.getElementById('export-excel');
            const clearButton = document.getElementById('clear-form');
            const form = document.getElementById('patient-form');
            
            const modal = document.getElementById('confirmation-modal');
            const closeModalButton = document.getElementById('close-modal');
            const modalMessage = document.getElementById('modal-message');

            function calculateIMC() {
                const peso = parseFloat(pesoInput.value);
                const altura = parseFloat(alturaInput.value);
                imcInput.value = (peso > 0 && altura > 0) ? (peso / (altura * altura)).toFixed(2) : '';
            }

            pesoInput.addEventListener('input', calculateIMC);
            alturaInput.addEventListener('input', calculateIMC);

            function showModal(message) {
                modalMessage.textContent = message;
                modal.classList.remove('hidden');
            }
            
            closeModalButton.addEventListener('click', () => modal.classList.add('hidden'));

            exportButton.addEventListener('click', function() {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                if (!data.nome || data.nome.trim() === '') {
                    showModal('Por favor, preencha pelo menos o nome do paciente para exportar.');
                    // Configura modal para erro
                    return;
                }

                const getCheckedValues = (name) => Array.from(form.querySelectorAll(`input[name="${name}"]:checked`)).map(cb => cb.value).join('; ');
                
                const classesUsadas = getCheckedValues('medicamento_classe');
                const queixasSelecionadas = getCheckedValues('queixa_item');

                const headers = [
                    'Nome', 'Filiação', 'CPF', 'Telefone', 'Endereço', 'Idade', 'Sexo', 'Peso (kg)', 'Altura (m)', 'IMC', 
                    'Ocupação', 'Etnia/Cor', 'Tipagem Sanguínea', 'Naturalidade', 'Cidade Natal', 'Escolaridade', 'Religião', 
                    'Tabagismo', 'Tabagismo Detalhes', 'Etilismo', 'Etilismo Detalhes', 'Drogas Ilicitas', 'Drogas Ilicitas Detalhes',
                    'Sedentarismo', 'Sedentarismo Detalhes', 'Ingestao Elevada Sal', 'Ingestao Sal Detalhes', 'Transtorno Social', 'Transtorno Social Detalhes',
                    'Hist. Familiar: Cardiopatia', 'Hist. Familiar: Neoplasia', 'Hist. Familiar: Diabetes', 'Hist. Familiar: DRC', 'Hist. Familiar: Doença Respiratória',
                    'Classes de Medicamentos Usados', 'Outros Medicamentos', 'Hipersensibilidade', 
                    'Queixas Selecionadas', 'Detalhes da Queixa'
                ];

                const values = [
                    data.nome, data.filiacao, data.cpf, data.telefone, data.endereco, data.idade, data.sexo, data.peso, data.altura, data.imc,
                    data.ocupacao, data.etnia, data.tipagem_sanguinea, data.naturalidade, data.cidade_natal, data.escolaridade, data.religiao,
                    data.tabagismo, data.tabagismo_detalhes, data.etilismo, data.etilismo_detalhes, data.drogas_ilicitas, data.drogas_ilicitas_detalhes,
                    data.sedentarismo, data.sedentarismo_detalhes, data.ingestao_sal, data.ingestao_sal_detalhes, data.transtorno_social, data.transtorno_social_detalhes,
                    data.familiar_cardiopatia, data.familiar_neoplasia, data.familiar_diabetes, data.familiar_drc, data.familiar_respiratorio,
                    classesUsadas, data.medicamentos_outros, data.hipersensibilidade,
                    queixasSelecionadas, data.queixa_detalhes
                ];

                const csvRow = values.map(value => {
                    const strValue = String(value || '');
                    return `"${strValue.replace(/"/g, '""')}"`;
                }).join(',');

                const csvContent = "data:text/csv;charset=utf-8," + headers.join(',') + '\n' + csvRow;

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                
                const fileName = `ficha_paciente_${(data.nome.replace(/ /g, '_') || 'novo_paciente').toLowerCase()}.csv`;
                link.setAttribute("download", fileName);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showModal(`O arquivo "${fileName}" foi gerado e o download deve começar em breve.`);
                // Configura modal para sucesso
            });
            
            clearButton.addEventListener('click', function() {
                form.reset();
                calculateIMC();
                showModal('O formulário foi limpo com sucesso.');
            });
        });
    </script>
</body>
</html>

